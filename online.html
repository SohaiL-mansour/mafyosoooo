<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mafyoso - Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„ØºÙ…ÙˆØ¶ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background:  url('bg.jpg');
            color: #ffffff;
            min-height: 100%;
            overflow-x: hidden;
        }

        /* Intro Screen Styles */
        .intro-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: 
                linear-gradient(rgba(15, 15, 35, 0.8), rgba(26, 10, 10, 0.9)),
                url('bg.jpg');
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .blood-title {
            font-size: 4rem;
            font-weight: 900;
            color: #8B0000;
            text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000;
            margin-bottom: 20px;
            position: relative;
            animation: pulse 2s infinite;
        }

        .blood-drip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 40px;
            background: linear-gradient(to bottom, #8B0000, #660000);
            border-radius: 0 0 50% 50%;
            animation: drip 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000; }
            50% { text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000, 0 0 80px #ff0000; }
        }

        @keyframes drip {
            0%, 70% { height: 40px; opacity: 1; }
            100% { height: 80px; opacity: 0; }
        }

        .welcome-message {
            font-size: 1.2rem;
            color: #FFD700;
            margin-bottom: 40px;
            text-align: center;
            max-width: 600px;
        }

        .game-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .main-btn {
            padding: 20px 50px;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
            min-width: 300px;
        }

        .main-btn:hover {
            background: linear-gradient(45deg, #DC143C, #FF6347);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(139, 0, 0, 0.6);
        }

        .secondary-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
            min-width: 300px;
        }

        .secondary-btn:hover {
            background: linear-gradient(45deg, #2a5298, #3d6cb9);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.6);
        }

        /* Room Creation/Join Screen */
        .room-screen {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .room-card {
            background: rgba(139, 0, 0, 0.1);
            border: 3px solid #8B0000;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .room-title {
            font-size: 2rem;
            color: #DC143C;
            margin-bottom: 30px;
            text-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }

        .input-group {
            margin: 20px 0;
            text-align: right;
        }

        .input-label {
            display: block;
            color: #FFD700;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #8B0000;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1.1rem;
            text-align: center;
            box-sizing: border-box;
        }

        .input-field:focus {
            outline: none;
            border-color: #DC143C;
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.3);
        }

        .room-code-display {
            background: rgba(255, 215, 0, 0.1);
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
            letter-spacing: 3px;
        }

        /* Lobby Screen */
        .lobby-screen {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .lobby-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .players-list {
            background: rgba(139, 0, 0, 0.1);
            border: 3px solid #8B0000;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .players-title {
            font-size: 1.8rem;
            color: #DC143C;
            text-align: center;
            margin-bottom: 20px;
        }

        .player-item {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .player-name {
            font-size: 1.2rem;
            color: #FFD700;
            font-weight: bold;
        }

        .player-status {
            font-size: 0.9rem;
            color: #2ed573;
        }

        .host-badge {
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Game Screen */
        .game-screen {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .round-title {
            font-size: 2.5rem;
            color: #DC143C;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(220, 20, 60, 0.5);
        }

        .role-display {
            background: rgba(30, 60, 114, 0.2);
            border: 3px solid #1e3c72;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .role-title {
            font-size: 1.5rem;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .role-info {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .role-innocent {
            color: #2ed573;
        }

        .role-mafioso {
            color: #ff4757;
            animation: evilGlow 2s infinite;
        }

        @keyframes evilGlow {
            0%, 100% { text-shadow: 0 0 10px #ff4757; }
            50% { text-shadow: 0 0 20px #ff4757, 0 0 30px #ff4757; }
        }

        .evidence-section {
            background: rgba(255, 215, 0, 0.1);
            border: 3px solid #FFD700;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .evidence-title {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .evidence-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #fff;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        /* Chat Section */
        .chat-section {
            background: rgba(139, 0, 0, 0.1);
            border: 3px solid #8B0000;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .chat-title {
            font-size: 1.8rem;
            color: #DC143C;
            text-align: center;
            margin-bottom: 20px;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .chat-message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 215, 0, 0.1);
        }

        .message-sender {
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .message-text {
            color: #fff;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #8B0000;
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
        }

        .chat-send-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: linear-gradient(45deg, #DC143C, #FF6347);
        }

        /* Voting Section */
        .voting-section {
            background: rgba(139, 0, 0, 0.1);
            border: 3px solid #8B0000;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .voting-title {
            font-size: 1.8rem;
            color: #DC143C;
            text-align: center;
            margin-bottom: 20px;
        }

        .vote-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .vote-btn {
            padding: 20px;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vote-btn:hover {
            background: linear-gradient(45deg, #DC143C, #FF6347);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
        }

        .vote-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .vote-btn.voted {
            background: linear-gradient(45deg, #2ed573, #20bf6b);
        }

        /* Results Screen */
        .results-screen {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .results-card {
            background: rgba(139, 0, 0, 0.1);
            border: 3px solid #8B0000;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            text-align: center;
        }

        .result-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .win-title {
            color: #2ed573;
            text-shadow: 0 0 20px #2ed573;
        }

        .lose-title {
            color: #ff4757;
            text-shadow: 0 0 20px #ff4757;
        }

        .crime-solution {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: right;
        }

        .solution-title {
            font-size: 1.5rem;
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
        }

        .solution-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #fff;
        }

        .back-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .back-btn:hover {
            background: linear-gradient(45deg, #2a5298, #3d6cb9);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.4);
        }

        .back-to-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-to-home-btn:hover {
            background: linear-gradient(45deg, #2a5298, #3d6cb9);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .status-message {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #FFD700;
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .blood-title {
                font-size: 2.5rem;
            }
            
            .vote-buttons {
                grid-template-columns: 1fr;
            }
            
            .result-title {
                font-size: 2rem;
            }
            
            .main-btn, .secondary-btn {
                min-width: 250px;
                font-size: 1.2rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Intro Screen -->
  <div id="introScreen" class="intro-screen">
   <h1 class="blood-title" id="gameTitle">ğŸ•µï¸  Mafyoso ğŸ”« 
    <div class="blood-drip"></div></h1>
   <p class="welcome-message" id="welcomeMessage">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„ØºÙ…ÙˆØ¶ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</p>
   <div class="game-buttons"><button class="main-btn" onclick="showRoomOptions()">ğŸŒ Ø§Ù„Ø¹Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</button> <button class="secondary-btn" onclick="playOffline()">ğŸ“± Ø§Ù„Ø¹Ø¨ Ø£ÙˆÙÙ„Ø§ÙŠÙ†</button>
   </div>
  </div><!-- Room Options Screen -->
  <div id="roomOptionsScreen" class="room-screen hidden"><button class="back-to-home-btn" onclick="backToHome()">â† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
   <div class="room-card">
    <div class="room-title">
     Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨
    </div>
    <div class="game-buttons"><button class="main-btn" onclick="showCreateRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button> <button class="secondary-btn" onclick="showJoinRoom()">ğŸšª Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©</button>
    </div>
   </div>
  </div><!-- Create Room Screen -->
  <div id="createRoomScreen" class="room-screen hidden"><button class="back-to-home-btn" onclick="showRoomOptions()">â† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØºØ±ÙØ©</button>
   <div class="room-card">
    <div class="room-title">
     Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
    </div>
    <div class="input-group"><label class="input-label">Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label> <input type="text" id="hostNameInput" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" maxlength="20">
    </div><button class="main-btn" onclick="createRoom()" id="createRoomBtn"> ğŸ  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© </button>
    <div id="roomCodeSection" class="hidden">
     <div class="status-message">
      ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!
     </div>
     <div class="room-code-display" id="roomCodeDisplay">
      ABC12
     </div>
     <p style="color: #FFD700; text-align: center;">Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</p>
    </div>
   </div>
  </div><!-- Join Room Screen -->
  <div id="joinRoomScreen" class="room-screen hidden"><button class="back-to-home-btn" onclick="showRoomOptions()">â† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØºØ±ÙØ©</button>
   <div class="room-card">
    <div class="room-title">
     Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØºØ±ÙØ©
    </div>
    <div class="input-group"><label class="input-label">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label> <input type="text" id="roomCodeInput" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©" maxlength="5" style="text-transform: uppercase;">
    </div>
    <div class="input-group"><label class="input-label">Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label> <input type="text" id="playerNameInput" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" maxlength="20">
    </div><button class="main-btn" onclick="joinRoom()" id="joinRoomBtn"> ğŸšª Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© </button>
   </div>
  </div><!-- Lobby Screen -->
  <div id="lobbyScreen" class="lobby-screen hidden"><button class="back-to-home-btn" onclick="leaveRoom()">â† Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
   <div class="game-header">
    <h2 class="round-title">ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
    <div class="room-code-display" id="lobbyRoomCode">
     ABC12
    </div>
   </div>
   <div class="players-list">
    <div class="players-title">
     ğŸ­ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† (<span id="playerCount">1</span>/4)
    </div>
    <div id="playersContainer"><!-- Players will be added here -->
    </div>
   </div>
   <div class="status-message" id="lobbyStatus">
    ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...
   </div>
   <div style="text-align: center;"><button class="main-btn hidden" id="startGameBtn" onclick="startOnlineGame()"> ğŸ¯ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© </button>
   </div>
  </div><!-- Online Game Screen -->
  <div id="onlineGameScreen" class="game-screen hidden"><button class="back-to-home-btn" onclick="leaveRoom()">â† Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
   <div class="game-header">
    <h2 class="round-title" id="onlineRoundTitle">Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</h2>
   </div><!-- Role Display -->
   <div class="role-display" id="roleDisplay">
    <div class="role-title">
     Ø¯ÙˆØ±Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
    </div>
    <div class="role-info" id="playerRole">
     Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
    </div>
   </div><!-- Evidence Section -->
   <div class="evidence-section">
    <div class="evidence-title">
     ğŸ” Ø§Ù„Ø¯Ù„ÙŠÙ„
    </div>
    <div class="evidence-text" id="onlineEvidence">
     Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ù„ÙŠÙ„...
    </div>
   </div><!-- Chat Section -->
   <div class="chat-section">
    <div class="chat-title">
     ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    </div>
    <div class="chat-messages" id="chatMessages"><!-- Chat messages will appear here -->
    </div>
    <div class="chat-input-container"><input type="text" id="chatInput" class="chat-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." maxlength="200"> <button class="chat-send-btn" onclick="sendChatMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
   </div><!-- Voting Section -->
   <div class="voting-section" id="votingSection">
    <div class="voting-title">
     ğŸ—³ï¸ ØµÙˆØª Ù„Ø·Ø±Ø¯ Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡
    </div>
    <p style="text-align: center; color: #FFD700; margin-bottom: 20px;">Ù†Ø§Ù‚Ø´ Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø«Ù… ØµÙˆØª Ø¹Ù„Ù‰ Ù…Ù† ØªØ´Ùƒ Ø£Ù†Ù‡ Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ</p>
    <div class="vote-buttons" id="onlineVoteButtons"><!-- Vote buttons will be generated here -->
    </div>
    <div class="status-message" id="votingStatus">
     ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø£ØµÙˆØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...
    </div>
   </div>
  </div><!-- Online Results Screen -->
  <div id="onlineResultsScreen" class="results-screen hidden">
   <div class="results-card">
    <div class="result-title" id="onlineResultTitle">
     Ø§Ù„Ù†ØªÙŠØ¬Ø©
    </div>
    <div id="onlineResultDescription"></div>
    <div class="crime-solution">
     <div class="solution-title">
      ÙƒÙŠÙÙŠØ© ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©
     </div>
     <div class="solution-text" id="onlineSolutionText"></div>
    </div><button class="back-btn" onclick="backToHome()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
   </div>
  </div>
  <script>
        // Crime database (same as offline version)
        const crimes = [
            {
                title: "Ø§Ø®ØªØ·Ø§Ù Ø±Ø¬Ù„ Ø£Ø¹Ù…Ø§Ù„ Ù…Ù† ÙÙ†Ø¯Ù‚",
                suspects: [
                    { name: "Ø·Ø§Ø±Ù‚", job: "Ø³Ø§Ø¦Ù‚" },
                    { name: "Ù†Ø§Ø¯ÙŠØ©", job: "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„" },
                    { name: "Ø±Ø¨ÙŠØ¹", job: "Ø£Ù…Ù†" },
                    { name: "Ø¬Ù†Ù‰", job: "Ù†Ø¸Ø§ÙØ©" }
                ],
                mafiosoIndex: 2,
                evidence: [
                    "ÙˆÙØ¬Ø¯Øª Ø¨Ø·Ø§Ù‚Ø© Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø±ÙˆÙ‚Ø© ÙÙŠ Ø³Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ù„Ø§Øª",
                    "ØªØ¹Ø·Ù„ Ø§Ù„Ù…ØµØ¹Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø«Ø§Ù…Ù†",
                    "ØªÙˆÙ‚ÙØª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„ØªØ§Ø³Ø¹ Ù„Ù…Ø¯Ø© 17 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø·"
                ],
                solution: "Ø£ÙˆÙ‚Ù Ø±Ø¨ÙŠØ¹ Ø§Ù„Ù…ØµØ¹Ø¯ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø§Ø¨Ù‚ÙŠÙ†ØŒ Ø£Ø¯Ø®Ù„ Ø±Ø¬Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØ£ÙÙ‚Ø¯Ù‡ Ø§Ù„ÙˆØ¹ÙŠØŒ ØªÙ… Ù†Ù‚Ù„Ù‡ ÙÙŠ Ø¹Ø±Ø¨Ø© Ø®Ø¯Ù…Ø© Ø¹Ø¨Ø± Ù…Ù…Ø± Ø®Ù„ÙÙŠØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù… Ø¨Ø·Ø§Ù‚Ø© Ù†Ø§Ø¯ÙŠØ© Ø§Ù„Ù…Ø²ÙˆØ±Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¯ÙˆÙ† Ù„ÙØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡."
            },
            {
                title: "ØªØ³Ù…ÙŠÙ… Ø®Ø¨ÙŠØ± Ø·Ø¹Ø§Ù… ÙÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø·Ø¨Ø®",
                suspects: [
                    { name: "Ø¹Ø§ØµÙ…", job: "Ø·Ø¨Ø§Ø®" },
                    { name: "Ù†Ù‡Ù‰", job: "Ù…Ù†Ø¸Ù…Ø© Ø¥Ù†ØªØ§Ø¬" },
                    { name: "Ø·Ù„Ø§Ù„", job: "Ù…Ø³Ø§Ø¹Ø¯ Ø·Ù‡ÙŠ" },
                    { name: "Ø±ÙŠÙ…", job: "Ù…ØªØ°ÙˆÙ‚Ø©" }
                ],
                mafiosoIndex: 2,
                evidence: [
                    "ÙˆÙØ¬Ø¯Øª Ù…Ø§Ø¯Ø© Ø³Ø§Ù…Ø© Ù…Ù† Ø£ØµÙ„ Ù†Ø¨Ø§ØªÙŠ ÙÙŠ Ø§Ù„Ù…Ø·Ø¨Ø®",
                    "Ø·Ø¨Ù‚ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙƒØ§Ù† Ù…ÙØ¹Ø¯Ø§Ù‹ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØµÙˆÙŠØ±",
                    "Ø§Ù„Ù…Ø·Ø¨Ø® Ø®Ø¶Ø¹ Ù„ÙØ­Øµ ØµØ­ÙŠ Ø´Ø§Ù…Ù„ Ù‚Ø¨Ù„ Ø§Ù„ØªØµÙˆÙŠØ± Ø¨ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯"
                ],
                solution: "Ø¯Ø³ Ø·Ù„Ø§Ù„ Ø§Ù„Ø³Ù… ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„ØªÙˆØ§Ø¨Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø§Ù„ØªÙŠ Ù„Ù… ØªÙÙØ­Øµ Ù…Ø®Ø¨Ø±ÙŠØ§Ù‹ØŒ ÙˆØ®Ù„Ø·Ù‡Ø§ ÙÙŠ Ø·Ø¨Ù‚ Ø§Ù„ØªØ­ÙƒÙŠÙ… Ù…Ø¨Ø§Ø´Ø±Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…. Ø§Ø³ØªØºÙ„ Ø§Ù†Ø´ØºØ§Ù„ Ø§Ù„Ø·Ø§Ù‚Ù… ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±."
            },
            {
                title: "Ø§Ø®ØªÙØ§Ø¡ ÙˆØ«Ø§Ø¦Ù‚ Ø­ÙƒÙˆÙ…ÙŠØ© Ø³Ø±ÙŠØ©",
                suspects: [
                    { name: "Ù‡Ø§Ù†ÙŠ", job: "Ø£Ø±Ø´ÙØ©" },
                    { name: "Ù„Ø¨Ù†Ù‰", job: "Ù…Ø­Ù„Ù„Ø© Ø¨ÙŠØ§Ù†Ø§Øª" },
                    { name: "ÙƒÙ…Ø§Ù„", job: "Ù…Ù†Ø¯ÙˆØ¨ Ø®Ø§Ø±Ø¬ÙŠ" },
                    { name: "Ø³Ø¹Ø§Ø¯", job: "Ù…Ø³Ø¤ÙˆÙ„Ø© Ø®Ø²Ù†Ø©" }
                ],
                mafiosoIndex: 2,
                evidence: [
                    "ÙˆÙØ¬Ø¯Øª Ø¢Ø«Ø§Ø± Ø£ØµØ§Ø¨Ø¹ ØºØ±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ù…ØºÙ„Ù Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚",
                    "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø²Ù†Ø© ÙŠØ¸Ù‡Ø± Ø¯Ø®ÙˆÙ„Ø§Ù‹ Ø±Ø³Ù…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯",
                    "Ø§ÙƒØªÙØ´Ù Ø¬Ù‡Ø§Ø² Ù…Ø³Ø­ Ø¶ÙˆØ¦ÙŠ ØµØºÙŠØ± Ù…Ø®ÙÙŠ ÙÙŠ Ø­Ù‚ÙŠØ¨Ø©"
                ],
                solution: "Ø§Ø³ØªØºÙ„ ÙƒÙ…Ø§Ù„ Ø²ÙŠØ§Ø±Ø© Ø±Ø³Ù…ÙŠØ©ØŒ ÙˆØ·Ù„Ø¨ Ù…Ù„ÙØ§Øª Ù„Ù„ÙØ­Øµ Ø«Ù… Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø§Ø³Ø­Ø§Ù‹ Ø¶ÙˆØ¦ÙŠØ§Ù‹ ØµØºÙŠØ±Ø§Ù‹ Ø¶Ù…Ù† Ø£ÙˆØ±Ø§Ù‚Ù‡. Ø·Ø¨Ø¹ Ù†Ø³Ø®Ø© Ù…Ø²ÙˆØ±Ø© ÙˆØªØ±Ùƒ Ø§Ù„Ø£ØµÙ„ Ø®Ù„ÙÙ‡ØŒ Ø«Ù… Ø¹Ø§Ø¯ Ø¨Ø¹Ø¯ ÙŠÙˆÙ…ÙŠÙ† ÙˆØ£Ø®Ø° Ø§Ù„Ø£ØµÙ„ Ø¨Ù‡Ø¯ÙˆØ¡."
            },
            {
                title: "Ø³Ø±Ù‚Ø© Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª Ù…Ù† Ø®Ø²Ù†Ø© Ø¹Ø§Ø¦Ù„ÙŠØ©",
                suspects: [
                    { name: "Ù…Ø§ÙŠØ§", job: "Ø§Ø¨Ù†Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©" },
                    { name: "Ù…Ø±Ø§Ø¯", job: "Ø®Ø§Ø¯Ù… Ù‚Ø¯ÙŠÙ…" },
                    { name: "Ø±ÙˆÙ„Ø§", job: "Ù…Ø­Ø§Ù…ÙŠØ©" },
                    { name: "Ø³Ù…ÙŠØ±", job: "ÙÙ†ÙŠ ØµÙŠØ§Ù†Ø©" }
                ],
                mafiosoIndex: 2,
                evidence: [
                    "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ ÙƒØ³Ø± Ø£Ùˆ ØªÙ„Ù ÙÙŠ Ù‚ÙÙ„ Ø§Ù„Ø®Ø²Ù†Ø©",
                    "ÙˆÙØ¬Ø¯Øª Ø¢Ø«Ø§Ø± Ù‚ÙØ§Ø²Ø§Øª Ø¬Ù„Ø¯ÙŠØ© ÙØ§Ø®Ø±Ø©",
                    "Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†Ø²Ù„ ØºÙŠØ± ÙˆØ§Ø¶Ø­ ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ø¯Ø«Ø©"
                ],
                solution: "Ø±ÙˆÙ„Ø§ ÙƒØ§Ù†Øª ØªÙ…Ù„Ùƒ Ø¥Ø°Ù†Ø§Ù‹ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ§Ù‹ Ù„Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ø²Ù†Ø©. Ø§Ø³ØªØºÙ„Øª Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø© Ù…Ø¹ Ø³Ù…ÙŠØ± Ù„ØªØºØ§ÙÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹ØŒ ÙˆÙØªØ­Øª Ø§Ù„Ø®Ø²Ù†Ø© Ø¨Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ØŒ Ø«Ù… Ø§Ø³ØªØ¨Ø¯Ù„Øª Ø§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª Ø¨Ø£Ø®Ø±Ù‰ Ù…Ù‚Ù„Ø¯Ø© ÙˆØºØ§Ø¯Ø±Øª Ø¨Ù‡Ø¯ÙˆØ¡."
            },
            {
                title: "Ù‚ØªÙ„ Ù…Ø¯ÙŠØ± Ù…ØµÙ†Ø¹ ÙÙŠ Ù…ÙƒØªØ¨Ù‡",
                suspects: [
                    { name: "ÙÙ‡Ø¯", job: "Ù…Ù‡Ù†Ø¯Ø³" },
                    { name: "Ø³Ù„Ù…Ù‰", job: "Ù…Ø­Ø§Ø³Ø¨Ø©" },
                    { name: "ÙˆÙ„ÙŠØ¯", job: "Ø¹Ø§Ù…Ù„" },
                    { name: "Ø¯ÙŠÙ†Ø§", job: "Ø³ÙƒØ±ØªÙŠØ±Ø©" }
                ],
                mafiosoIndex: 1,
                evidence: [
                    "ÙˆÙØ¬Ø¯ ÙƒÙˆØ¨ Ù‚Ù‡ÙˆØ© Ù…Ø³Ù…ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨",
                    "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø¬Ù„Ø§Øª Ù…Ø§Ù„ÙŠØ© Ù…Ø²ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø®Ø²Ù†Ø©",
                    "Ø§Ù„Ø¨Ø§Ø¨ ÙƒØ§Ù† Ù…Ù‚ÙÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„"
                ],
                solution: "Ø³Ù„Ù…Ù‰ Ø§ÙƒØªØ´ÙØª ÙØ³Ø§Ø¯ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆÙ‡Ø¯Ø¯Ù‡Ø§ Ø¨Ø§Ù„ÙØµÙ„. Ø¯Ø³Øª Ø§Ù„Ø³Ù… ÙÙŠ Ù‚Ù‡ÙˆØªÙ‡ Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©ØŒ ÙˆØ²ÙˆØ±Øª Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„ØªØ¨Ø¯Ùˆ ÙˆÙƒØ£Ù† Ø§Ù„Ù…Ø¯ÙŠØ± Ù‡Ùˆ Ø§Ù„Ù…Ø®ØªÙ„Ø³."
            }
        ];

        // Game state
        let gameState = {
            mode: 'online', // 'online' or 'offline'
            currentRoom: null,
            currentPlayer: null,
            isHost: false,
            gamePhase: 'intro', // intro, lobby, game, results
            selectedCrime: null,
            currentRound: 1,
            playerRole: null,
            hasVoted: false,
            chatMessages: []
        };

        // Default configuration
        const defaultConfig = {
            game_title: "Mafyoso",
            welcome_message:  "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø© ÙˆØ§Ù„ØºÙ…ÙˆØ¶"
        };

        // Shared storage for rooms using localStorage with room codes as keys
        function saveRoom(roomCode, roomData) {
            localStorage.setItem(`mafyoso_room_${roomCode}`, JSON.stringify(roomData));
            // Trigger storage event for other tabs/windows
            window.dispatchEvent(new StorageEvent('storage', {
                key: `mafyoso_room_${roomCode}`,
                newValue: JSON.stringify(roomData)
            }));
        }
        
        function getRoom(roomCode) {
            const roomData = localStorage.getItem(`mafyoso_room_${roomCode}`);
            return roomData ? JSON.parse(roomData) : null;
        }
        
        function updateRoom(roomCode, roomData) {
            roomData.updated_at = new Date().toISOString();
            saveRoom(roomCode, roomData);
        }

        // Listen for storage changes from other tabs/windows
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('mafyoso_room_') && e.newValue) {
                const roomCode = e.key.replace('mafyoso_room_', '');
                if (gameState.currentRoom && gameState.currentRoom.room_code === roomCode) {
                    const updatedRoom = JSON.parse(e.newValue);
                    const previousGameState = gameState.currentRoom.game_state;
                    gameState.currentRoom = updatedRoom;
                    
                    // Handle game state transitions
                    if (previousGameState === 'lobby' && updatedRoom.game_state === 'playing') {
                        showMessage('Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ®', '#2ed573');
                        setTimeout(() => {
                            showOnlineGame();
                        }, 1500);
                    } else if (updatedRoom.game_state === 'lobby') {
                        updateLobbyUI();
                    } else if (updatedRoom.game_state === 'playing') {
                        updateOnlineGameUI();
                        if (updatedRoom.chat_messages) {
                            gameState.chatMessages = updatedRoom.chat_messages;
                            updateChatMessages();
                        }
                    }
                }
            }
        });

        // Initialize app
        async function initializeApp() {
            // Initialize Element SDK
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        const gameTitle = config.game_title || defaultConfig.game_title;
                        const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
                        
                        document.getElementById('gameTitle').textContent = gameTitle;
                        document.getElementById('welcomeMessage').textContent = welcomeMessage;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["game_title", config.game_title || defaultConfig.game_title],
                        ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
                    ])
                });
            }
        }

        // Generate random room code
        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Show room options
        function showRoomOptions() {
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('roomOptionsScreen').classList.remove('hidden');
        }

        // Show create room screen
        function showCreateRoom() {
            document.getElementById('roomOptionsScreen').classList.add('hidden');
            document.getElementById('createRoomScreen').classList.remove('hidden');
        }

        // Show join room screen
        function showJoinRoom() {
            document.getElementById('roomOptionsScreen').classList.add('hidden');
            document.getElementById('joinRoomScreen').classList.remove('hidden');
        }

        // Create room
        async function createRoom() {
            const hostName = document.getElementById('hostNameInput').value.trim();
            
            if (!hostName) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹', '#ff4757');
                return;
            }

            const createBtn = document.getElementById('createRoomBtn');
            createBtn.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
            createBtn.disabled = true;

            try {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const roomCode = generateRoomCode();
                const roomId = `room_${Date.now()}`;
                
                const roomData = {
                    room_id: roomId,
                    room_code: roomCode,
                    host_name: hostName,
                    players: [{
                        name: hostName,
                        isHost: true,
                        joinedAt: new Date().toISOString()
                    }],
                    game_state: 'lobby',
                    selected_crime: null,
                    current_round: 1,
                    votes: {},
                    eliminated_players: [],
                    chat_messages: [],
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                // Store room in shared localStorage
                saveRoom(roomCode, roomData);
                
                gameState.currentRoom = roomData;
                gameState.currentPlayer = { name: hostName, isHost: true };
                gameState.isHost = true;
                
                document.getElementById('roomCodeDisplay').textContent = roomCode;
                document.getElementById('roomCodeSection').classList.remove('hidden');
                
                showMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!', '#2ed573');
                
                // Auto-navigate to lobby after 2 seconds
                setTimeout(() => {
                    showLobby();
                }, 2000);
                
            } catch (error) {
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©', '#ff4757');
            } finally {
                createBtn.innerHTML = 'ğŸ  Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©';
                createBtn.disabled = false;
            }
        }

        // Join room
        async function joinRoom() {
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            const playerName = document.getElementById('playerNameInput').value.trim();
            
            if (!roomCode || !playerName) {
                showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙˆØ§Ø³Ù…Ùƒ', '#ff4757');
                return;
            }

            const joinBtn = document.getElementById('joinRoomBtn');
            joinBtn.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…...';
            joinBtn.disabled = true;

            try {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check if room exists in shared storage
                const roomData = getRoom(roomCode);
                
                if (!roomData) {
                    throw new Error('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                }
                
                if (roomData.players.length >= 4) {
                    throw new Error('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©');
                }
                
                // Check if name already exists
                if (roomData.players.some(p => p.name === playerName)) {
                    throw new Error('Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                }
                
                // Add player to room
                roomData.players.push({
                    name: playerName,
                    isHost: false,
                    joinedAt: new Date().toISOString()
                });
                
                // Update room in shared storage
                updateRoom(roomCode, roomData);
                
                gameState.currentRoom = roomData;
                gameState.currentPlayer = { name: playerName, isHost: false };
                gameState.isHost = false;
                
                showMessage('ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© Ø¨Ù†Ø¬Ø§Ø­!', '#2ed573');
                
                setTimeout(() => {
                    showLobby();
                }, 1500);
                
            } catch (error) {
                showMessage(error.message || 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©', '#ff4757');
            } finally {
                joinBtn.innerHTML = 'ğŸšª Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©';
                joinBtn.disabled = false;
            }
        }

        // Show lobby
        function showLobby() {
            document.getElementById('createRoomScreen').classList.add('hidden');
            document.getElementById('joinRoomScreen').classList.add('hidden');
            document.getElementById('lobbyScreen').classList.remove('hidden');
            
            updateLobbyUI();
            
            // Start auto-refresh for lobby
            startLobbyAutoRefresh();
        }
        
        // Auto-refresh lobby to show new players and game state changes
        let lobbyRefreshInterval;
        function startLobbyAutoRefresh() {
            // Clear any existing interval
            if (lobbyRefreshInterval) {
                clearInterval(lobbyRefreshInterval);
            }
            
            // Refresh every 1 second for better responsiveness
            lobbyRefreshInterval = setInterval(() => {
                if (gameState.currentRoom && gameState.currentRoom.room_code) {
                    // Get latest room data
                    const latestRoomData = getRoom(gameState.currentRoom.room_code);
                    if (latestRoomData) {
                        const previousGameState = gameState.currentRoom.game_state;
                        const previousPlayerCount = gameState.currentRoom.players ? gameState.currentRoom.players.length : 0;
                        
                        gameState.currentRoom = latestRoomData;
                        
                        // Check if game state changed from lobby to playing
                        if (previousGameState === 'lobby' && latestRoomData.game_state === 'playing') {
                            // Game started! Transition to game screen
                            stopLobbyAutoRefresh();
                            showMessage('Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ®', '#2ed573');
                            setTimeout(() => {
                                showOnlineGame();
                            }, 1500);
                        } else if (latestRoomData.game_state === 'lobby') {
                            // Still in lobby, update UI
                            const currentPlayerCount = latestRoomData.players ? latestRoomData.players.length : 0;
                            
                            // Show message if player count changed
                            if (currentPlayerCount > previousPlayerCount) {
                                showMessage('Ø§Ù†Ø¶Ù… Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯! ğŸ‘‹', '#2ed573');
                            } else if (currentPlayerCount < previousPlayerCount) {
                                showMessage('ØºØ§Ø¯Ø± Ø£Ø­Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ğŸ‘‹', '#ff4757');
                            }
                            
                            updateLobbyUI();
                        }
                    }
                }
            }, 1000);
        }
        
        function stopLobbyAutoRefresh() {
            if (lobbyRefreshInterval) {
                clearInterval(lobbyRefreshInterval);
                lobbyRefreshInterval = null;
            }
        }

        // Update lobby UI
        function updateLobbyUI() {
            if (!gameState.currentRoom) return;
            
            document.getElementById('lobbyRoomCode').textContent = gameState.currentRoom.room_code;
            
            const players = gameState.currentRoom.players || [];
            document.getElementById('playerCount').textContent = players.length;
            
            const playersContainer = document.getElementById('playersContainer');
            playersContainer.innerHTML = '';
            
            // Check if current player is still in the room
            const currentPlayerStillInRoom = players.some(player => 
                player.name === gameState.currentPlayer.name
            );
            
            if (!currentPlayerStillInRoom && gameState.currentPlayer) {
                // Current player was removed from room (kicked or connection lost)
                showMessage('ØªÙ… Ø¥Ø®Ø±Ø§Ø¬Ùƒ Ù…Ù† Ø§Ù„ØºØ±ÙØ©', '#ff4757');
                setTimeout(() => {
                    backToHome();
                }, 2000);
                return;
            }
            
            // Update host status if needed
            const hostPlayer = players.find(player => player.isHost);
            if (hostPlayer && hostPlayer.name === gameState.currentPlayer.name) {
                gameState.isHost = true;
            } else {
                gameState.isHost = false;
            }
            
            players.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                playerItem.innerHTML = `
                    <div>
                        <div class="player-name">ğŸ‘¤ ${player.name}</div>
                        <div class="player-status">Ù…ØªØµÙ„</div>
                    </div>
                    ${player.isHost ? '<div class="host-badge">Ù…Ø¶ÙŠÙ</div>' : ''}
                `;
                
                playersContainer.appendChild(playerItem);
            });
            
            // Update status and start button
            const startBtn = document.getElementById('startGameBtn');
            const statusMsg = document.getElementById('lobbyStatus');
            
            if (players.length === 4) {
                statusMsg.textContent = 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¬Ø§Ù‡Ø²ÙˆÙ†! ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©';
                if (gameState.isHost) {
                    startBtn.classList.remove('hidden');
                }
            } else {
                statusMsg.textContent = `ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†Ø¶Ù…Ø§Ù… ${4 - players.length} Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ†...`;
                startBtn.classList.add('hidden');
            }
        }

        // Start online game
        async function startOnlineGame() {
            if (!gameState.isHost) return;
            
            try {
                // Select random crime
                const randomCrime = crimes[Math.floor(Math.random() * crimes.length)];
                const players = gameState.currentRoom.players;
                
                // Assign roles randomly
                const shuffledPlayers = [...players];
                for (let i = shuffledPlayers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledPlayers[i], shuffledPlayers[j]] = [shuffledPlayers[j], shuffledPlayers[i]];
                }
                
                // Assign crime suspects to players
                const gameData = {
                    crime: randomCrime,
                    playerRoles: shuffledPlayers.map((player, index) => ({
                        playerName: player.name,
                        suspect: randomCrime.suspects[index],
                        isMafioso: index === randomCrime.mafiosoIndex
                    }))
                };
                
                // Update room with game data
                gameState.currentRoom.game_state = 'playing';
                gameState.currentRoom.selected_crime = gameData;
                gameState.currentRoom.current_round = 1;
                gameState.currentRoom.updated_at = new Date().toISOString();
                
                // Update shared storage
                updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
                
                showOnlineGame();
                
            } catch (error) {
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©', '#ff4757');
            }
        }

        // Show online game
        function showOnlineGame() {
            document.getElementById('lobbyScreen').classList.add('hidden');
            document.getElementById('onlineGameScreen').classList.remove('hidden');
            
            // Stop lobby refresh and start game refresh
            stopLobbyAutoRefresh();
            startGameAutoRefresh();
            
            updateOnlineGameUI();
        }
        
        // Auto-refresh during game to sync votes and chat
        let gameRefreshInterval;
        function startGameAutoRefresh() {
            // Clear any existing interval
            if (gameRefreshInterval) {
                clearInterval(gameRefreshInterval);
            }
            
            // Refresh every 2 seconds during game for better sync
            gameRefreshInterval = setInterval(() => {
                if (gameState.currentRoom && gameState.currentRoom.room_code) {
                    // Get latest room data
                    const latestRoomData = getRoom(gameState.currentRoom.room_code);
                    if (latestRoomData) {
                        const previousGameState = gameState.currentRoom.game_state;
                        gameState.currentRoom = latestRoomData;
                        
                        // Check if game finished
                        if (latestRoomData.game_state === 'finished' && latestRoomData.game_result) {
                            stopGameAutoRefresh();
                            const result = latestRoomData.game_result;
                            showOnlineResults(result.innocents_win, latestRoomData.selected_crime);
                            return;
                        }
                        
                        // Update game UI with latest data
                        updateOnlineGameUI();
                        
                        // Sync chat messages
                        if (latestRoomData.chat_messages) {
                            gameState.chatMessages = latestRoomData.chat_messages;
                            updateChatMessages();
                        }
                    }
                }
            }, 2000);
        }
        
        function stopGameAutoRefresh() {
            if (gameRefreshInterval) {
                clearInterval(gameRefreshInterval);
                gameRefreshInterval = null;
            }
        }

        // Update online game UI
        function updateOnlineGameUI() {
            if (!gameState.currentRoom) return;
            
            const gameData = gameState.currentRoom.selected_crime;
            if (!gameData || !gameData.crime) return;
            
            // Check if game finished and show results
            if (gameState.currentRoom.game_state === 'finished' && gameState.currentRoom.game_result) {
                const result = gameState.currentRoom.game_result;
                showOnlineResults(result.innocents_win, gameData);
                return;
            }
            
            // Find player's role
            const playerRole = gameData.playerRoles.find(role => 
                role.playerName === gameState.currentPlayer.name
            );
            
            if (playerRole) {
                gameState.playerRole = playerRole;
                
                // Update role display
                const roleElement = document.getElementById('playerRole');
                const suspectName = playerRole.suspect.name;
                const suspectJob = playerRole.suspect.job;
                
                if (playerRole.isMafioso) {
                    roleElement.innerHTML = `${suspectName} - ${suspectJob}<br><span class="role-mafioso">Ù…Ø§ÙÙŠÙˆØ³Ùˆ ğŸ’€</span>`;
                } else {
                    roleElement.innerHTML = `${suspectName} - ${suspectJob}<br><span class="role-innocent">Ø¨Ø±ÙŠØ¡ âœ…</span>`;
                }
            }
            
            // Update round and evidence
            const currentRound = gameState.currentRoom.current_round || 1;
            document.getElementById('onlineRoundTitle').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${currentRound}`;
            
            const evidenceIndex = currentRound - 1;
            if (gameData.crime.evidence && gameData.crime.evidence[evidenceIndex]) {
                document.getElementById('onlineEvidence').textContent = gameData.crime.evidence[evidenceIndex];
            }
            
            // Update vote buttons
            updateVoteButtons(gameData);
            
            // Update voting status
            updateVotingStatus();
            
            // Update chat
            updateChatMessages();
        }
        
        // Update voting status
        function updateVotingStatus() {
            const votingStatus = document.getElementById('votingStatus');
            if (!gameState.currentRoom || !votingStatus) return;
            
            const totalPlayers = gameState.currentRoom.players.length;
            const totalVotes = Object.keys(gameState.currentRoom.votes || {}).length;
            
            if (gameState.currentRoom.voting_complete) {
                votingStatus.textContent = 'ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØµÙˆÙŠØª! Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...';
                votingStatus.style.color = '#2ed573';
            } else if (totalVotes === 0) {
                votingStatus.textContent = 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø£ØµÙˆØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†...';
                votingStatus.style.color = '#FFD700';
            } else {
                votingStatus.textContent = `ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª: ${totalVotes}/${totalPlayers} Ù„Ø§Ø¹Ø¨ÙŠÙ†`;
                votingStatus.style.color = '#FFD700';
            }
        }

        // Update vote buttons
        function updateVoteButtons(gameData) {
            const voteButtons = document.getElementById('onlineVoteButtons');
            voteButtons.innerHTML = '';
            
            gameData.playerRoles.forEach((role, index) => {
                const button = document.createElement('button');
                button.className = 'vote-btn';
                button.innerHTML = `ğŸ‘¤ ${role.playerName}<br><small style="opacity: 0.8;">(${role.suspect.name} - ${role.suspect.job})</small>`;
                button.onclick = () => voteOnlinePlayer(index);
                
                // Check if current player has voted
                const currentPlayerVote = gameState.currentRoom.votes && gameState.currentRoom.votes[gameState.currentPlayer.name];
                if (currentPlayerVote !== undefined) {
                    gameState.hasVoted = true;
                    button.disabled = true;
                    if (currentPlayerVote === index) {
                        button.classList.add('voted');
                    }
                } else {
                    gameState.hasVoted = false;
                }
                
                // Disable all buttons if voting is complete
                if (gameState.currentRoom.voting_complete) {
                    button.disabled = true;
                }
                
                voteButtons.appendChild(button);
            });
        }

        // Vote for online player
        async function voteOnlinePlayer(playerIndex) {
            if (gameState.hasVoted) return;
            
            try {
                gameState.hasVoted = true;
                
                // Update vote button appearance
                const voteButtons = document.querySelectorAll('.vote-btn');
                voteButtons[playerIndex].classList.add('voted');
                voteButtons.forEach(btn => btn.disabled = true);
                
                // Update room's vote data in shared storage
                if (gameState.currentRoom) {
                    if (!gameState.currentRoom.votes) {
                        gameState.currentRoom.votes = {};
                    }
                    gameState.currentRoom.votes[gameState.currentPlayer.name] = playerIndex;
                    updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
                }
                
                showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!', '#2ed573');
                
                // Check if all players have voted (only host checks this)
                if (gameState.isHost) {
                    setTimeout(() => {
                        checkVotingCompletion();
                    }, 2000);
                }
                
            } catch (error) {
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØª', '#ff4757');
                gameState.hasVoted = false;
            }
        }
        
        // Check if all players have voted (host only)
        function checkVotingCompletion() {
            if (!gameState.isHost || !gameState.currentRoom) return;
            
            const totalPlayers = gameState.currentRoom.players.length;
            const totalVotes = Object.keys(gameState.currentRoom.votes || {}).length;
            
            if (totalVotes >= totalPlayers) {
                // All players voted, calculate results
                calculateVotingResults();
            }
        }
        
        // Calculate voting results (host only)
        function calculateVotingResults() {
            if (!gameState.isHost || !gameState.currentRoom) return;
            
            const votes = gameState.currentRoom.votes || {};
            const voteCounts = {};
            
            // Count votes for each player
            Object.values(votes).forEach(playerIndex => {
                voteCounts[playerIndex] = (voteCounts[playerIndex] || 0) + 1;
            });
            
            // Find player with most votes
            let eliminatedIndex = 0;
            let maxVotes = 0;
            Object.entries(voteCounts).forEach(([playerIndex, count]) => {
                if (count > maxVotes) {
                    maxVotes = count;
                    eliminatedIndex = parseInt(playerIndex);
                }
            });
            
            // Update room with results
            gameState.currentRoom.eliminated_player = eliminatedIndex;
            gameState.currentRoom.voting_complete = true;
            updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
            
            // Process results
            setTimeout(() => {
                processVotingResults(eliminatedIndex);
            }, 1000);
        }
        
        // Process voting results
        function processVotingResults(eliminatedIndex) {
            const gameData = gameState.currentRoom.selected_crime;
            const mafiosoIndex = gameData.crime.mafiosoIndex;
            const mafiosoEliminated = eliminatedIndex === mafiosoIndex;
            
            if (mafiosoEliminated || gameState.currentRoom.current_round >= 3) {
                // Game over
                gameState.currentRoom.game_state = 'finished';
                gameState.currentRoom.game_result = {
                    innocents_win: mafiosoEliminated,
                    eliminated_player: eliminatedIndex,
                    mafioso_index: mafiosoIndex
                };
                updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
                
                showOnlineResults(mafiosoEliminated, gameData);
            } else {
                // Next round
                gameState.currentRoom.current_round++;
                gameState.currentRoom.votes = {}; // Reset votes
                gameState.currentRoom.voting_complete = false;
                gameState.hasVoted = false;
                updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
                
                updateOnlineGameUI();
                showMessage('Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù†!', '#FFD700');
            }
        }

        // Simulate voting results
        function simulateVotingResults() {
            const gameData = JSON.parse(gameState.currentRoom.selected_crime);
            const mafiosoIndex = gameData.crime.mafiosoIndex;
            
            // Simulate random voting outcome
            const eliminatedIndex = Math.floor(Math.random() * 4);
            const mafiosoEliminated = eliminatedIndex === mafiosoIndex;
            
            if (mafiosoEliminated || gameState.currentRoom.current_round >= 3) {
                showOnlineResults(mafiosoEliminated, gameData);
            } else {
                // Next round
                gameState.currentRoom.current_round++;
                gameState.hasVoted = false;
                updateOnlineGameUI();
                showMessage('Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù†!', '#FFD700');
            }
        }

        // Show online results
        function showOnlineResults(innocentsWin, gameData) {
            document.getElementById('onlineGameScreen').classList.add('hidden');
            document.getElementById('onlineResultsScreen').classList.remove('hidden');
            
            const resultTitle = document.getElementById('onlineResultTitle');
            const resultDescription = document.getElementById('onlineResultDescription');
            
            const mafiosoPlayer = gameData.playerRoles.find(role => role.isMafioso);
            
            if (innocentsWin) {
                resultTitle.textContent = 'ğŸ‰ Ø§Ù„Ø£Ø¨Ø±ÙŠØ§Ø¡ ÙØ§Ø²ÙˆØ§!';
                resultTitle.className = 'result-title win-title';
                resultDescription.innerHTML = `
                    <p style="color: #2ed573; font-size: 1.3rem;">
                        ØªÙ… Ø§Ù„Ù‚Ø¨Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ Ø¨Ù†Ø¬Ø§Ø­!
                    </p>
                    <p style="color: #FFD700;">
                        Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ ÙƒØ§Ù†: <strong style="color: #ff4757;">${mafiosoPlayer.playerName}</strong>
                        <br>Ø§Ù„Ø´Ø®ØµÙŠØ©: <strong>${mafiosoPlayer.suspect.name}</strong>
                    </p>
                `;
            } else {
                resultTitle.textContent = 'ğŸ’€ Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ ÙØ§Ø²!';
                resultTitle.className = 'result-title lose-title';
                resultDescription.innerHTML = `
                    <p style="color: #ff4757; font-size: 1.3rem;">
                        ÙØ´Ù„ Ø§Ù„Ø£Ø¨Ø±ÙŠØ§Ø¡ ÙÙŠ ÙƒØ´Ù Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ!
                    </p>
                    <p style="color: #FFD700;">
                        Ø§Ù„Ù…Ø§ÙÙŠÙˆØ³Ùˆ ÙƒØ§Ù†: <strong style="color: #ff4757;">${mafiosoPlayer.playerName}</strong>
                        <br>Ø§Ù„Ø´Ø®ØµÙŠØ©: <strong>${mafiosoPlayer.suspect.name}</strong>
                    </p>
                `;
            }
            
            document.getElementById('onlineSolutionText').textContent = gameData.crime.solution;
        }

        // Send chat message
        async function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message || !gameState.currentPlayer) return;
            
            try {
                const chatMessage = {
                    sender: gameState.currentPlayer.name,
                    message: message,
                    timestamp: new Date().toISOString()
                };
                
                // Add to local chat
                gameState.chatMessages.push(chatMessage);
                
                // Update room's chat messages in shared storage
                if (gameState.currentRoom) {
                    gameState.currentRoom.chat_messages = gameState.chatMessages;
                    updateRoom(gameState.currentRoom.room_code, gameState.currentRoom);
                }
                
                // Clear input
                chatInput.value = '';
                
                // Update chat display
                updateChatMessages();
                
            } catch (error) {
                showMessage('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', '#ff4757');
            }
        }

        // Update chat messages
        function updateChatMessages() {
            const chatContainer = document.getElementById('chatMessages');
            chatContainer.innerHTML = '';
            
            gameState.chatMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                
                messageDiv.innerHTML = `
                    <div class="message-sender">${msg.sender}</div>
                    <div class="message-text">${msg.message}</div>
                `;
                
                chatContainer.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Leave room
        function leaveRoom() {
            // Create custom confirmation dialog
            const confirmDialog = document.createElement('div');
            confirmDialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: flex-start;
                align-items: center;
                z-index: 10000;
            `;
            
            confirmDialog.innerHTML = `
                <div style="
                    background: rgba(139, 0, 0, 0.1);
                    border: 3px solid #8B0000;
                    border-radius: 20px;
                    padding: 40px;
                    text-align: center;
                    max-width: 400px;
                    color: white;
                ">
                    <h3 style="color: #DC143C; margin-bottom: 20px;">Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</h3>
                    <p style="margin-bottom: 30px; color: #FFD700;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©ØŸ</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="confirmLeaveRoom()" style="
                            padding: 12px 25px;
                            background: linear-gradient(45deg, #ff4757, #ff6b7a);
                            border: none;
                            border-radius: 15px;
                            color: white;
                            font-weight: bold;
                            cursor: pointer;
                        ">Ù†Ø¹Ù…ØŒ ØºØ§Ø¯Ø±</button>
                        <button onclick="cancelLeaveRoom()" style="
                            padding: 12px 25px;
                            background: linear-gradient(45deg, #1e3c72, #2a5298);
                            border: none;
                            border-radius: 15px;
                            color: white;
                            font-weight: bold;
                            cursor: pointer;
                        ">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDialog);
        }

        // Confirm leave room
        function confirmLeaveRoom() {
            // Remove player from room before leaving
            if (gameState.currentRoom && gameState.currentPlayer) {
                const roomData = getRoom(gameState.currentRoom.room_code);
                if (roomData) {
                    // Remove current player from players list
                    roomData.players = roomData.players.filter(player => 
                        player.name !== gameState.currentPlayer.name
                    );
                    
                    // If host is leaving and there are other players, transfer host to first remaining player
                    if (gameState.isHost && roomData.players.length > 0) {
                        roomData.players[0].isHost = true;
                        roomData.host_name = roomData.players[0].name;
                    }
                    
                    // Update room in storage
                    updateRoom(gameState.currentRoom.room_code, roomData);
                }
            }
            
            // Stop all auto-refresh intervals
            stopLobbyAutoRefresh();
            stopGameAutoRefresh();
            
            // Reset game state
            gameState.currentRoom = null;
            gameState.currentPlayer = null;
            gameState.isHost = false;
            gameState.hasVoted = false;
            gameState.chatMessages = [];
            
            // Remove confirmation dialog
            const dialog = document.querySelector('div[style*="position: fixed"]');
            if (dialog) {
                dialog.remove();
            }
            
            backToHome();
        }

        // Cancel leave room
        function cancelLeaveRoom() {
            const dialog = document.querySelector('div[style*="position: fixed"]');
            if (dialog) {
                dialog.remove();
            }
        }

        // Play offline (redirect to original game)
      function playOffline() {
    window.location.href = "index.html";
}

        // Update game UI based on current state
        function updateGameUI() {
            if (gameState.gamePhase === 'lobby') {
                updateLobbyUI();
            } else if (gameState.gamePhase === 'game') {
                updateOnlineGameUI();
            }
        }

        // Back to home
        function backToHome() {
            // Stop all auto-refresh intervals
            stopLobbyAutoRefresh();
            stopGameAutoRefresh();
            
            // Reset game state
            gameState = {
                mode: 'online',
                currentRoom: null,
                currentPlayer: null,
                isHost: false,
                gamePhase: 'intro',
                selectedCrime: null,
                currentRound: 1,
                playerRole: null,
                hasVoted: false,
                chatMessages: []
            };
            
            // Hide all screens except intro
            document.querySelectorAll('.room-screen, .lobby-screen, .game-screen, .results-screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById('introScreen').classList.remove('hidden');
        }

        // Show temporary message
        function showMessage(text, color) {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.9);
                color: ${color};
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            message.textContent = text;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => message.remove(), 300);
            }, 3000);
        }

        // Add enter key support for chat
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            
            // Add enter key support for chat input
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Add enter key support for room code input
            document.getElementById('roomCodeInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    joinRoom();
                }
            });
            
            // Add enter key support for player name input
            document.getElementById('playerNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    joinRoom();
                }
            });
            
            // Add enter key support for host name input
            document.getElementById('hostNameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    createRoom();
                }
            });
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a0d4aa8071be16b',t:'MTc2MzUyOTk3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>